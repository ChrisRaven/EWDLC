// ==UserScript==
// @author     Iliyan Georgiev
// @author     Krzysztof Kruk
// @name       EyeWire DLC (KK)
// @namespace  http://crazyman4865.com/eyewire
// @version    1.4.1
// @description  A script to add various functionality to EyeWire
// @include    https://eyewire.org/*
// @include    https://beta.eyewire.org/*
// @exclude    https://eyewire.org/1.0/*
// @copyright  2017+, Iliyan Georgiev
// @run-at     document-idle
// @grant      none
// @source     https://github.com/crazyman4865/EWDLC
// @supportURL https://github.com/crazyman4865/EWDLC/issues
// @updateURL  https://github.com/ChrisRaven/EWDLC/raw/master/build/ewdlc.min.user.js
// @downloadURL  https://github.com/ChrisRaven/EWDLC/raw/master/build/ewdlc.min.user.js
// ==/UserScript==


// https://github.com/crazyman4865/EWDLC/blob/master/LICENSE
var EWDLC=function(e){"use strict";function t(e,t,n){var a=this,o=new Set,i=e,s=n,c=t;a.getName=function(){return i},a.getDefault=function(){return s},a.setDefault=function(e){s=e},a.registerCallback=function(e){e&&typeof e==typeof Function&&o.add(e)},a.unregisterCallback=function(e){o.delete(e)},a.getValue=function(){return c},a.setValue=function(e){c!==e&&(c=e,o.forEach(e=>e(i,c)))},a.reset=function(){a.setValue(s)}}function n(e){var n=this,a={},o="ewdlc-prefs",i=!1;function s(){let e={};for(let t in a)e[t]=a[t].getValue();localStorage.setItem(o,JSON.stringify(e))}n.registerSetting=function(e){e&&e instanceof t&&(a[e.getName()]=e,a[e.getName()].registerCallback(s))},n.getSetting=function(e){return a[e]},n.init=function(){i||($(document).trigger("ewdlc-preferences-loading"),function(){let e=localStorage.getItem(o);if(!e)return;let t=JSON.parse(e);for(let e in t){let a=n.getSetting(e);a&&a.setValue(t[e])}}(),$(document).trigger("ewdlc-preferences-loaded"),i=!0)}}function a(e){var t=e,n=!1;this.getUsername=function(){return t},this.isReady=function(){return n},this.refreshInfo=function(){return new Promise((e,a)=>{let o="/1.0/player/";o+=t?t+"/bio":"describe",$.getJSON(o).done(a=>{t=a.username,n=!0,e()}).fail(a)})}}function o(){var e;function n(){e=$("<div>").addClass("settings-group invisible"),$("<h1>").text("EyeWire DLC").appendTo(e),e.appendTo("#settingsMenu")}this.makeCheckbox=function(a,o){if(!(a&&a instanceof t&&o))return;e||n();let i=$("<div>").addClass("setting");$("<span>").text(o).appendTo(i);let s=$("<input>").attr("type","checkbox").hide().appendTo(i);s.prop("checked",!!a.getValue()),s.checkbox().each(function(){var e=$(this);a.getValue()?e.removeClass("off").addClass("on"):e.removeClass("on").addClass("off")}),s.change(function(e){e.stopPropagation();var t=$(this);a.setValue(t.is(":checked"))}),i.find(".checkbox").click(function(e){var t=s;t.prop("checked",!t.is(":checked")),t.change()}),i.click(function(e){e.stopPropagation();var t=s;t.prop("checked",!t.is(":checked")),t.change()});var c=e.find(".setting > .minimalButton").first();c.length>0?i.insertBefore(c.parent()):i.appendTo(e)},this.makeButton=function(t){if(!t)return;e||n();let a=$("<div>").addClass("setting"),o=$("<div>").addClass("minimalButton").text(t).appendTo(a);return a.appendTo(e),o}}var i={normal:0,frozen:10,stashed:6,duplicate:11};function s(e){var t=this,i=!1,s=e;t.preferences=new n(t),t.account=new a,t.modules={},t.settingsUi=new o,t.init=function(){i||(t.preferences.init(),t.account.refreshInfo().then(()=>$(document).trigger("ewdlc-account-ready")),i=!0)},t.getResourceUrl=function(e){return s+e}}function c(e){var t=(e=e||{}).name,n=e.prefix,a=e.scope,o=0,i=!1,s=$("<span>").text(t),c=$("<div>").addClass("chatTab").append(s).append($("<span>").css("margin-left","3px").addClass("sl-badge").text("0").hide()).append($("<i>").addClass("fa").addClass("fa-close").css("margin-left","3px").hide());this.getElement=function(){return c},this.getPrefix=function(){return n},this.getScope=function(){return a},this.getName=function(){return t},this.getUnread=function(){return o},this.isPMTab=function(){return n.startsWith("/pm")},this.isClosed=function(){return i},this.setName=function(e){t=e,c.text(name)},this.setActive=function(e){e?(o=0,c.addClass("active")):c.removeClass("active")},this.setUnread=function(e){if(!isNaN(e)&&e>=0){o=e;let t=c.children("span.sl-badge");t.text(o),o>0?t.show():t.hide()}},this.close=function(){c.removeClass("active").addClass("disabled"),c.css("margin-left",-c.outerWidth()+"px"),i=!0},this.open=function(){c.removeClass("disabled"),c.css("margin-left","0px"),i=!1},n.startsWith("/pm")&&(c.children("i").show(),$.get("/1.0/player/"+a+"/bio").done(function(e){$(".chatInput").val().startsWith(n)&&$(".chatInput").val("/pm "+e.username+" "+$(".chatInput").val().substring(n.length)),a=e.username,n="/pm "+e.username+" ",s.text(a)}))}function r(e){var n={"tc-show-timestamp":new t("tc-show-timestamp",!0),"tc-show-all-in-tabs":new t("tc-show-all-in-tabs",!0),"tc-show-points-msgs":new t("tc-show-points-msgs",!0),"tc-show-channels-in-all":new t("tc-show-channels-in-all",!0),"tc-enable-unread":new t("tc-enable-unread",!0),"tc-grayout-messages":new t("tc-grayout-messages",!1),"tc-show-leaderboard":new t("tc-show-leaderboard",!0),"tc-allow-backslash-prefix":new t("tc-allow-backslash-prefix",!0),"tc-enable-markup":new t("tc-enable-markup",!0),"tc-show-connection-statuses":new t("tc-show-connection-statuses",!1)},a=[{key:"tc-show-timestamp",lang:"Chat Timestamp"},{key:"tc-show-all-in-tabs",lang:"General Chat visible in all channels"},{key:"tc-show-channels-in-all",lang:"All channels visible in General Chat"},{key:"tc-show-points-msgs",lang:"Points messages"},{key:"tc-enable-unread",lang:"Unread messages counter"},{key:"tc-grayout-messages",lang:"Show all hidden messages as faded instead"},{key:"tc-show-leaderboard",lang:"Leaderboard pop-up after cube submission"},{key:"tc-allow-backslash-prefix",lang:"Allow backslash as command prefix"},{key:"tc-enable-markup",lang:"Enable markup"},{key:"tc-show-connection-statuses",lang:"Show connection statuses"}];this.set=function(e,t){n[e].setValue(t)},this.get=function(e){return n[e].getValue()},$(document).on("ewdlc-preferences-loading",function(){for(var t in n)n.hasOwnProperty(t)&&(ewdlc.preferences.registerSetting(n[t]),n[t].registerCallback(e))}),$(document).on("ewdlc-preferences-loaded",function(){for(let e in a)a.hasOwnProperty(e)&&ewdlc.settingsUi.makeCheckbox(n[a[e].key],a[e].lang)})}function l(e){var t={};function n(){tomni.chat.addMsg({},"An error was encountered while running this command. Please wait a moment and try again.")}function a(e){var t=tomni.cell,n=15;if(e.length>=2)if("this"===e[1].toLowerCase())t=tomni.cell;else if(t=parseInt(e[1]),isNaN(t)||t<=0)return{cellId:-1,limit:n};return e.length>=3&&(n=parseInt(e[2]),isNaN(n))?{cellId:-1,limit:n}:(n<=0&&(n=99999),{cellId:t,limit:n})}this.bind=function(e,n,a,o){t[e]={},t[e].description=n,t[e].usage=a,t[e].callback=o},this.unbind=function(e){t[e]&&delete t[e]},this.exec=function(e){if(!e)return!1;var n=e.split(" ");if(0===n.length)return!1;var a=t[n[0]];return!!a&&(a.callback(n),!0)},this.bind("/help","","",function(e){for(var n in tomni.chat.addMsg({},"------------------"),tomni.chat.addMsg({},"Tabbed Chat commands:"),t)if("/help"!==n){var a=t[n],o=n;(a.description||a.usage)&&(o+=": "),a.description&&(o+=a.description),a.description&&a.usage&&(o+=", Usage: "),a.usage&&(o+=a.usage),tomni.chat.addMsg({},o)}tomni.chat.addMsg({},"------------------")}),this.bind("/add-cell","Adds one or more cells to the overview","/add-cell Cell ID 1[#hhhhhh] [Cell ID 2[#hhhhhh]] ..., where hhhhhh is a hex color code",function(e){let t,n,a,o,i;for(let s=1;s<e.length;s++)-1!==e[s].indexOf("#")?(t=e[s].split("#"),n=parseInt(t[0],10),a=t[1]):(n=parseInt(e[s],10),a=!1),a&&(tomni.prefs.get("plasticize")?(i=ColorUtils.rotate,ColorUtils.rotate=function(){return ColorUtils.hexToRGB(a)}):(o=Cell.colors,Cell.colors={custom:{rgb:ColorUtils.hexToRGB(a)}})),n&&$.when(tomni.threeD.addCell({cellid:n,center:!0})).then(function(e){tomni.prefs.get("plasticize")?ColorUtils.rotate=i:Cell.colors=o})}),this.bind("/remove-cell","Removes one or more cells from the overview","/remove-cell Cell ID 1 [Cell ID 2] ...",function(e){for(var t=1;t<e.length;t++){var n=parseInt(e[t],10);isNaN(n)||tomni.threeD.removeCell(n)}}),this.bind("/show-cell","Shows the current cell (if it was hidden using /hide-cell)","",function(){tomni.getCurrentCell().show()}),this.bind("/hide-cell","Hides the current cell","",function(){tomni.getCurrentCell().hide()}),this.bind("/size","Shows the size of the current cell","",function(e){var t=tomni.threeD.getCell(tomni.cell).info;tomni.chat.history.add(e[0]),$.get("/1.0/cell/"+tomni.cell+"/tasks").done(function(e){var n=e.tasks.filter(function(e){return e.status!=i.stashed});tomni.chat.addMsg({},t.name+" is "+n.length+" cube"+(1!==e.tasks.length?"s":"")+" big.")}).fail(n)}),this.bind("/guess","Submits your current coordinates as a hunt guess","",function(e){if(tomni.getCurrentCell().info.is_hunt){var t=tomni.center.rotation.clone().multiplyScalar(100).round().multiplyScalar(.01).floor(),n="/pm thehunt "+(t=(t=[t.x,t.y,t.z]).join(" "));tomni.chat.submitChatMessage(n)}else tomni.chat.addMsg({},"You must be in a hunt cell to use this command.")}),this.bind("/clear","Clears the chat","",function(e){$(".chatMsgContainer").empty(),tomni.chat.addMsg({},"The chat has been cleared.")}),this.bind("/markup","Shows available markup tags","",function(){tomni.chat.addMsg({},"Type: ・・Some text・・ to apply markup."),tomni.chat.addMsg({}," "),tomni.chat.addMsg({},'"・・" cany be any of the following: '),tomni.chat.addMsg({},"**    bold"),tomni.chat.addMsg({},"||    italic"),tomni.chat.addMsg({},"__    underline"),tomni.chat.addMsg({},"--    strikethrough"),tomni.chat.addMsg({}," "),tomni.chat.addMsg({},'e.g. __text__ will give you "text" word underlined.'),tomni.chat.addMsg({}," "),tomni.chat.addMsg({},"Symbols CAN be combined, e.g. **a ||b** c||"),tomni.chat.addMsg({},'will give you bold "a", bold & cursive "b" and cursive "c"'),tomni.chat.addMsg({}," ")}),account.can("scout scythe mystic admin")&&this.bind("/dupe","Lists the duplicates in the current cube","",function(e){if(account.can("scout scythe mystic admin"))if(tomni.chat.history.add(e[0]),tomni.gameMode&&tomni.task.inspect)if(0!==tomni.task.duplicates.length){var t="Duplicates in the current cube:\n ";t+=tomni.task.duplicates.map(function(e){return"#"+e.task_id}).join(" "),tomni.chat.addMsg({},t)}else tomni.chat.addMsg({},"There are no duplicates in this cube.");else tomni.chat.addMsg({},"You must be inspecting a cube to use this command.");else tomni.chat.addMsg({},"You must be a scout or higher to use this command.")}),account.can("scythe mystic admin")&&(this.bind("/low-wt","Lists low weight cubes in cell","/low-wt [cell=this] [limit=15]",function(e){var t=function(e,t,n,a,o){var i=0,s=e,c="";if(o[n]&&o[n].length>0&&o[n].findIndex(function(e){return $.inArray(e.task_id,a)>=0})){c+="Weight "+n+":\n  ";for(var r=o[n].length-1;r>=0;r--)if(!($.inArray(o[n][r].task_id,a)>=0)){if(c+="#"+o[n][r].task_id,(e<t-1||0!==r)&&(c+="  "),i++,++e===t)break;4===i&&r>0&&(c+="\n ",i=0)}}return{msg:c,counter:e,any:s!=e}},o=function(){tomni.chat.addMsg({},"Usage: /low-wt [cell=this] [limit=15]")};if(account.can("scout")){var i=a(e);if(i.cellId<0)o();else{var s=i.cellId,c=i.limit;e.length>3?o():(tomni.chat.history.add(e.join(" ")),$.get("/1.0/cell/"+s+"/heatmap/scythe").done(function(e){var a=e.frozen;$.get("/1.0/cell/"+s+"/heatmap/low-weight?weight=3").done(function(e){for(var n=0,o="Low weight cubes in cell "+s+" (limit "+c+"): ",i=0;i<3;i++){var r=t(n,c,i.toString(),a,e);if(r.any&&(o+="\n "),o+=r.msg,(n=r.counter)>=c)break}0===n?tomni.chat.addMsg({},"There are no low weight cubes in cell "+s):tomni.chat.addMsg({},o)}).fail(n)}).fail(n))}}else tomni.chat.addMsg({},"You must be a scout or higher to use this command.")}),this.bind("/sc-info","Shows count of the SC you've done, the amount you can do, and lists cube IDs with SC < 2, wt >= 3","/sc-info [cell=this] [limit=15]",function(e){var t=function(){tomni.chat.addMsg({},"Usage: /sc-info [cell=this] [limit=15]")},o=function(e,t){for(var n=0;n<t.length;n++){var a=e.indexOf(t[n]);a>=0&&e.splice(a,1)}return e};if(account.can("scythe mystic admin")){var s=a(e);if(s.cellId<0)t();else{var c=s.cellId,r=s.limit;e.length>3?t():(tomni.chat.history.add(e.join(" ")),tomni.chat.addMsg({},"Please wait while Grim's minions collect some data..."),$.when($.getJSON("/1.0/cell/"+c+"/tasks"),$.getJSON("/1.0/cell/"+c+"/heatmap/scythe"),$.getJSON("/1.0/cell/"+c+"/tasks/complete/player")).done(function(e,t,n){e=function(e){return e.filter(function(e){return e.status!=i.frozen&&e.status!=i.stashed})}(e[0].tasks),t=t[0],n=n[0];for(var a=e.map(e=>e.id),s=t.frozen||[],l=t.complete||[],d=0;d<l.length;d++)if(!(l[d].votes<2)){var u=a.indexOf(l[d].id);u>=0&&a.splice(u,1)}o(a,e.filter(e=>e.weight<3).map(e=>e.id)),o(a,s);var h=n.scythe[account.account.uid.toString()]||[];h=h.concat(n.admin[account.account.uid.toString()]||[]),o(a,h);var f=0,m="Scythe info for cell "+c+" (limit "+r+"):\n";if(m+="Your SC count: "+h.length+"\n",m+="Cubes you can SC: "+a.length+"\n",a.length>0)for(m+="List:\n ",d=0;d<a.length&&(m+="#"+a[d]+" ",++f!==r);d++);tomni.chat.addMsg({},m)}).fail(n))}}else tomni.chat.addMsg({},"You must be a scythe or higher to use this command.")}),this.bind("/low-wt-sc","Shows count and list of the SC you've done, where wt < 3","/low-wt-sc [cell=this] [limit=15]",function(e){if(account.can("scythe mystic admin")){var t=a(e);if(!(t.cellId<0)){var o=t.cellId,i=t.limit;e.length>3||(tomni.chat.history.add(e.join(" ")),$.when($.getJSON("/1.0/cell/"+o+"/heatmap/low-weight?weight=3"),$.getJSON("/1.0/cell/"+o+"/tasks/complete/player")).done(function(e,t){e=e[0];let n=(t=t[0]).scythe[account.account.uid.toString()]||[];n=n.concat(t.admin[account.account.uid.toString()]||[]);let a=[];for(let t=0;t<3;t++){let n=e[t];for(let e=0;e<n.length;e++)a.push(n[e].task_id)}let s=(c=a,n.filter(e=>c.includes(e)));var c,r=0,l="Low weight SC info for cell "+o+" (limit "+i+"):\n";if(l+="Cubes you completed with low weight: "+s.length+"\n",s.length>0){l+="List:\n ";for(var d=0;d<s.length&&(l+="#"+s[d]+" ",++r!==i);d++);}tomni.chat.addMsg({},l)}).fail(n))}}else tomni.chat.addMsg({},"You must be a scythe or higher to use this command.")}))}function d(){var e,t=[],n=[],a=this,o=$(".chatInput"),i=["(scouts)","(mystics)","(mods)","(mentors)","(admins)"],s=$("<div>").addClass("tabList").insertAfter(".chatInput");function d(e){var t=e.children(".userName").text(),n=0!==e.children(".userName").length,a=e.children(".dialogNobody").not(".tc-timestamp,.tc-msg-text").text().trim(),o=a.substring(1,a.length-1);e.find(".actualText").html();return{username:t,hasUsername:n,scopeText:a,target:o,contentNode:e.find(".actualText")}}function h(e){return e.includes(" earned ")&&e.includes(" points")||e.includes(" trailblazed a cube")||e.includes(" scythed a cube for")||e.includes(" scouted a cube for")||e.includes(" has joined!")||e.includes(" has left!")}function f(){t.filter(function(e){return!e.isClosed()}).length>1?function(){let e=$(".chatInput");e.animate({bottom:"50px"},{complete:function(){s.fadeIn()}}),$(".chatMsgContainer").animate({bottom:50+e.outerHeight(!0)+"px"})}():s.fadeOut(function(){let e=$(".chatInput");e.animate({bottom:"10px"}),$(".chatMsgContainer").animate({bottom:10+e.outerHeight(!0)+"px"})})}function m(t,o){var s=t.username.toLowerCase(),c=t.hasUsername,r=t.scopeText,l=t.target.toLowerCase(),d=i.indexOf(r);if("All"===e.getName()){if(c&&r&&!a.prefs.get("tc-show-channels-in-all"))return!0;if(!a.prefs.get("tc-show-points-msgs"))if(h(o.find(".dialogNobody").text()))return!0;return!1}if("Commands"===e.getName()){var u=o.find(".dialogNobody").text();return!!(c||h(u)||function(e){return e.includes(" joined crew ")}(u))||o.find(".special,.generic").length>0}if(c){if(d>=0)return r!==e.getScope();if(!r&&a.prefs.get("tc-show-all-in-tabs")&&!e.isPMTab())return!1;if("(private)"===r&&e.getScope().toLowerCase()===s||n.indexOf(l)>=0&&e.getScope().toLowerCase()===l)return!1}return c||e.isPMTab()?!(o.find(".special").length>0&&!e.isPMTab()):h(o.find(".dialogNobody").text())}function p(){var t=[],n=[],o=[],i=[],s=a.prefs.get("tc-grayout-messages"),c="Commands"===e.getName();$(".chatMsg").each(function(){var e=d($(this));g($(this),e),m(e,$(this))?e.hasUsername&&s&&!c?(o.push($(this)),n.push($(this))):t.push($(this)):(e.hasUsername&&s&&i.push($(this)),n.push($(this)))}),$(t).map(function(){return this.toArray()}).hide(),$(n).map(function(){return this.toArray()}).show(),$(o).map(function(){return this.toArray()}).find(".tc-msg-text").addClass("dialogNobody"),$(i).map(function(){return this.toArray()}).find(".tc-msg-text").removeClass("dialogNobody"),$(".chatMsgContainer").scrollTop($(".chatMsgContainer")[0].scrollHeight)}function g(e,t){if(t.hasUsername){var n=e.find(".tc-timestamp");a.prefs.get("tc-show-timestamp")?n.show():n.hide()}}a.addTab=function(n,a,i){var r=new c({name:n,prefix:a,scope:i});return s.append(r.getElement()),r.getElement().on("click.tabbedChat",function(n){e!==r&&(e.setActive(!1),r.setActive(!0),r.setUnread(0),n.stopPropagation(),(!o.val().trim()||o.val().startsWith("/pm ")||t.findIndex(function(e){return o.val().trim()===e.getPrefix().trim()})>=0)&&o.val(r.getPrefix()),e=r,o.focus(),p(),$(".chatMsgContainer").scrollTop($(".chatMsgContainer")[0].scrollHeight))}),r.getElement().children("i").on("click.tabbedChat",function(e){r.close(),t[0].getElement().click(),e.stopPropagation(),f()}),t.push(r),f(),r},this.prefs=new r(function(){if(!a.prefs.get("tc-enable-unread"))for(var e=0;e<t.length;e++)t[e].setUnread(0);a.prefs.get("tc-grayout-messages")?$(".chatMsg").show():$(".chatMsg").find(".tc-msg-text").removeClass("dialogNobody");p()}),a.getActiveTab=function(){return e};var b=/&lt;([0-9]+)(,| |, )([0-9]+)(,| |, )([0-9]+)&gt;/g;function w(){let e=b.exec($(this).html());if(e){let t=parseInt(e[1],10),n=parseInt(e[3],10),a=parseInt(e[5],10);tomni.ui.recenterView(new THREE.Vector3(-t,-n,-a))}}function v(e){if(""===window.getSelection().toString()){e.preventDefault(),e.stopPropagation();var t=$(this).text().match(/^(t|task|tid)?#(\d+)$/i),n=parseInt(t[2],10);window.open(window.location.origin+"?tcJumpTaskId="+n)}}function y(e){$(this).addClass("clicked"),e.stopPropagation()}function C(){$("#charLeft").text(Math.max(0,180-$(".chatInput").val().length))}function k(n){if(n.ctrlKey&&(188===n.which||190===n.which)){n.preventDefault(),n.stopPropagation();var a=t.indexOf(e);if(188===n.which){for(a--;a>=0&&t[a].getElement().hasClass("disabled");)a--;a>=0&&t[a].getElement().click()}else if(190===n.which){for(a++;a<t.length&&t[a].getElement().hasClass("disabled");)a++;a<t.length&&t[a].getElement().click()}}}let x={"*":!1,"|":!1,_:!1,"-":!1};function S(e,t,n){let a="";return n===e&&(a=x[e]?"</"+t+">":"<"+t+">",x[e]=!x[e]),a}function T(){account.can("scythe mystic admin")&&a.addTab("Commands","",""),account.can("scout scythe mystic admin")&&a.addTab("Scouts","/gm scouts ","(scouts)"),account.can("mystic admin")&&a.addTab("Mystics","/gm mystics ","(mystics)"),account.can("moderator admin")&&a.addTab("Mods","/gm mods ","(mods)"),account.can("mentor admin")&&a.addTab("Mentors","/gm mentors ","(mentors)"),account.can("admin")&&a.addTab("Admins","/gm admins ","(admins)"),f()}(e=a.addTab("All","","")).setActive(!0),ewdlc&&ewdlc.account.isReady()?(a.commandProcessor=new l(a),T()):$(document).on("ewdlc-account-ready",function(){T(),a.commandProcessor=new l(a)}),o.focus(function(){p(),$("#charLeft").fadeIn(200)}).focusout(function(){$("#charLeft").fadeOut(200)}),new MutationObserver(function(s){var c=s[0];if(!c.addedNodes)return;var r=$(c.addedNodes[0]);if(r.find(".link.coords").on("click.tabbedChat",w),r.find(".tc-timestamp").length>0||r.find(".link.coords").length>0)return;r.find(".taskid").on("click.tabbedChat",y).contextmenu(v);var l,u=d(r),h="";u.hasUsername&&(a.prefs.get("tc-enable-markup")&&function(e){let t,n=e[0].childNodes;for(let a=0,o=n.length;a<o;a++)if(3===n[a].nodeType){t=n[a].data;let o="",i="",s="",c="";for(let e=0,n=t.length;e<n;e++)switch(s=i,i=o,o=t.charAt(e)){case"*":c+=S("*","b",i);break;case"|":c+=S("|","i",i);break;case"_":c+=S("_","u",i);break;case"-":c+=S("-","strike",i);break;case"<":c+="&lt;";break;default:-1!==["*","|","_","-"].indexOf(i)&&s!==i&&(c+=i),c+=o}-1!==["*","|","_","-"].indexOf(o)&&i!==o&&(c+=o);let r=document.createElement("span");r.innerHTML=c,e[0].replaceChild(r,n[a])}}(u.contentNode),function(e){var t=new Date,n=t.getHours().toString();1==n.length&&(n="0"+n);var a=t.getMinutes().toString();1==a.length&&(a="0"+a);var o=n+":"+a;$("<span>").addClass("dialogNobody").addClass("tc-timestamp").html(o+"&nbsp;").prependTo(e)}(r),r.find(".actualText").addClass("tc-msg-text"));if(g(r,u),function(e){var t,o=e.hasUsername,s=e.scopeText;if(o&&s){if("(private)"===s)t=e.username;else{if(!(i.indexOf(s)<0))return;t=s.substring(1,s.length-1)}n.indexOf(t.toLowerCase())<0&&(n.push(t.toLowerCase()),a.addTab(t,"/pm "+t+" ",t))}}(u),m(u,r)&&(u.hasUsername&&a.prefs.get("tc-grayout-messages")&&"Commands"!==e.getName()?r.find(".actualText").addClass("dialogNobody"):r.hide(),u.hasUsername)){var p="chat_public";r.find(".playerCallOut.me").length>0&&(p="chat_private"),i.indexOf(u.scopeText)>=0?h=u.scopeText:"(private)"===u.scopeText?(p="chat_private",h=u.username):n.indexOf(u.target)>=0&&(h=u.target),o.is(":focus")&&SFX.play(p),l=t.findIndex(function(e){return e.getScope()==h}),a.prefs.get("tc-enable-unread")&&t[l].setUnread(t[l].getUnread()+1)}"(private)"===u.scopeText?h=u.username:n.indexOf(u.target)>=0&&(h=u.target);l=t.findIndex(function(e){return e.getScope()==h}),t[l].open(),f(),o.removeClass("pulsing"),function(e){let t=e.html(),n=t.replace(b,function(e){return'<span class="link coords">'+e+"</span>"});n!==t&&(e.remove(),$("<div>").addClass("chatMsg").html(n).appendTo($(".chatMsgContainer")))}(r)}).observe(document.getElementsByClassName("chatMsgContainer")[0],{childList:!0,attributres:!1,characterData:!1,subtree:!1}),o.off("keydown").keydown(function(e){o.click(),e.ctrlKey&&k(e),e.keyCode===Keycodes.codes.shift||e.metaKey||e.ctrlKey||e.stopPropagation();var n=$(this).val();if(e.keyCode===Keycodes.codes.enter){(e.shiftKey||e.metaKey||e.ctrlKey)&&e.stopPropagation(),$(this).val(""),tomni.chat.history.locator=-1;var i=t.findIndex(function(e){return"All"!==e.getName()&&"Commands"!==e.getName()&&n.startsWith(e.getPrefix())});if(i>=0){var s=n.substring(t[i].getPrefix().length);if(s.startsWith("/"))return $(this).val(t[i].getPrefix()),"/help"===s.trim()?(tomni.chat.submitChatMessage(s),a.commandProcessor.exec(s),!1):!a.commandProcessor.exec(s)&&tomni.chat.submitChatMessage(s)}if(n.startsWith("/")||a.prefs.get("tc-allow-backslash-prefix")&&n.startsWith("\\")){if(n.startsWith("\\")&&(n="/"+n.substring(1)),"/help"===n.trim())return tomni.chat.submitChatMessage(n),a.commandProcessor.exec(n),!1;if(a.commandProcessor.exec(n))return!1}return tomni.chat.submitChatMessage(n)}return e.keyCode===Keycodes.codes.up?tomni.chat.history.up(this):e.keyCode!==Keycodes.codes.down||tomni.chat.history.down(this)}),o.on("keydown keypress",function(e){e.stopPropagation()}),$(document).on("keydown.tabbedChat",k);var I=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("tcJumpTaskId");I&&($(".threeDPanel").on("cell-meshes-loaded.tabbedChat",function(){tomni.jumpToTaskID(parseInt(I,10)),$(this).off("cell-meshes-loaded.tabbedChat")}),history.replaceState({},"Cube Jump",window.location.origin)),$("<div>").addClass("charLeftContainer").insertAfter(".chatInput").append($("<span>").text("180").attr("id","charLeft").hide()),$(".chatInput").on("input.tabbedChat change.tabbedChat",C),setInterval(C,500),u.onmessage=function(e){let t=e.data;a.prefs.get("tc-show-connection-statuses")&&t&&"alert"===(t=JSON.parse(t)).cmd&&("connect"===t.params.type?tomni.chat.addMsg(null,t.params.attr.username+" has joined!"):"disconnect"===t.params.type&&tomni.chat.addMsg(null,t.params.attr.username+" has left!"))}}let u;function h(){var e=tomni.taskManager.ui.showLeaderboard;tomni.taskManager.ui.showLeaderboard=function(t){if(!ewdlc.modules.tabbedChat.prefs.get("tc-show-leaderboard"))return t.callback("proceed"),void $("#edit-cube-loader").css("opacity","0");e(t)}}function f(){function e(e,t,n){$("<div>").addClass("icon").attr("title",n).addClass(e).appendTo("#funStats"),$("<div>").attr("id",t).text("No Data").appendTo("#funStats")}var t;function n(){i.css("opacity","0"),setTimeout(function(){i.appendTo("#funStats"),i.css("visibility","hidden"),o.css("visibility","visible"),o.css("opacity","1"),t=setTimeout(a,1e4)},350)}function a(){o.css("opacity","0"),setTimeout(function(){o.appendTo("#funStats"),o.css("visibility","hidden"),i.css("visibility","visible"),i.css("opacity","1"),t=setTimeout(n,1e4)},350)}Profile.updateAlwaysVisibleStats=function(e){var t=function(e){return Utils.numberToCondensedSI({number:e,fit:6,maxchars:6,precision:0})};(e=e||{}).username&&"grimreaper"===e.username.toLowerCase()?($("#pointsValue").addClass("grimReaperPoints").html("&infin;"),$("#cubesValue").addClass("grimReaperPoints").html("&infin;"),$("#trailblazingsValue").addClass("grimReaperPoints").html("&infin;"),$("#funStats #scythedCubes").addClass("grimReaperPoints").html("&infin;"),$("#funStats #completedCubes").addClass("grimReaperPoints").html("&infin;")):($("#pointsValue").text(t(e.points)),$("#trailblazingsValue").text(t(e.trailblazes)),$("#cubesValue").text(t(e.cubes)),e.scythes&&$("#funStats #scythedCubes").text(t(e.scythes)),e.complete&&$("#funStats #completedCubes").text(t(e.complete))),$("#acc").text(e.username)},tomni.taskManager.ui.modeSet=function(){$.getJSON("/1.0/player/"+encodeURIComponent(account.account.username)+"/stats",function(e){account.account.stats=e,Profile.updateAlwaysVisibleStats({username:account.account.username,points:e.forever.points,cubes:e.forever.cubes,trailblazes:e.forever.trailblazes,scythes:e.forever.scythes,complete:e.forever.complete})})};var o,i=$("#funStats div").slice(0,6),s=!0;function c(){$(window).width()>=1920?s||(s=!0,clearTimeout(t),i.css("visibility","visible"),i.css("opacity","1"),o&&(o.appendTo($("#funStats")),o.css("visibility","visible"),o.css("opacity","1"))):s&&(s=!1,o&&(t=setTimeout(n,1e4),o.css("visibility","hidden"),o.css("opacity","0")))}account.refresh=function(e){return $.getJSON("/1.0/player/describe/").done(function(t){t&&t.id&&(account.account.username=t.username,account.account.uid=t.id,account.account.rank=t.class,account.account.joined=new Date(t.joined),account.account.country=t.country,account.account.country_name=t.country_name,account.account.trained=t.trained,account.account.newbie=t.newbie,account.account.first_timer=t.first_timer,account.account.language=t.language,account.account.level=t.level||0,account.assignRoles(t),$.getJSON("/1.0/player/"+account.account.username+"/stats",function(e){Profile.updateAlwaysVisibleStats({username:t.username,points:e.forever.points,cubes:e.forever.cubes,trailblazes:e.forever.trailblazes,scythes:e.forever.scythes,complete:e.forever.complete}),account.account.stats=e}),$("#acc").html($("#logoutButtons").html()),e&&e.call(this),$(document).trigger("account-info-ready",[account]))})},$(document).on("ewdlc-account-ready",function(){account.can("scout scythe mystic admin")&&(e("scytheIcon","scythedCubes","Cubes Scythed"),o=$("#funStats div").slice(6,8)),account.can("scythe mystic admin")&&(e("completedCubesIcon","completedCubes","Cubes Completed"),o=$("#funStats div").slice(6,10)),c(),account.refresh()}),$(document).resize(c)}function m(){var e=new t("tc-enlarge-reap-buttons",!1,!1),n=new t("tc-swap-moveon-flag",!1,!1),a=$.Deferred(),o=$.Deferred();function i(e,t){$(".reapAuxButton").toggleClass("tcEnlargeButtons",t),$("#editActions").toggleClass("tcEnlargeButtons",t)}function s(t,n){var a=$("#flagCube"),o=$("#actionInspectReviewContinue");n?(a.insertAfter($("#deselectSeedGT")).addClass("reapAuxButton enabled tcFlagSwapped").removeClass("reaperButton").empty(),o.insertAfter($("#saveGT")).addClass("reaperButton tcFlagSwapped").removeClass("reapAuxButton enabled").text("Move On"),$("<i>").addClass("fa fa-flag-o").appendTo(a)):(a.insertAfter($("#saveGT")).addClass("reaperButton").removeClass("reapAuxButton enabled tcFlagSwapped").empty().text("Flag"),o.insertAfter($("#deselectSeedGT")).addClass("reapAuxButton enabled").removeClass("reaperButton tcFlagSwapped").empty()),i(0,e.getValue())}$(document).on("ewdlc-account-ready",function(){!function(){if(!account.can("mystic admin"))return;let e=$("#jumpContainer").clone().detach(),t=e.find("input"),n=e.find("button");e[0].id="additionalJumpContainer",n.insertBefore(t),t.attr("placeholder","           Enter Cell #"),t.attr("id","cellJumpField"),n.attr("disabled","true"),n.attr("id","cellJumpButton"),t.ion("keydown keypress",function(e){e.stopPropagation()}),n.click(function(e){e.preventDefault();var n=t.removeClass("error"),a=parseInt(n.val(),10);return isNaN(a)?(n.addClass("error"),!1):(tomni.setCell({id:a}).fail(function(){n.addClass("error")}),!1)}),t.ion("change keyup input",function(e){e.stopPropagation(),n.prop("disabled",0===$(this).val().length),e.keyCode!==Keycodes.codes.enter?$(this).removeClass("error"):n.click()}),e.appendTo("#cubeFinder")}(),$("<div>").attr("title","Decrease brush size (q)").addClass("fob brush dec").click(function(e){e.stopPropagation(),SFX.play("button"),tomni.prefs.decreaseBrushSize()}).insertAfter($("#mst-slider-container")),$("<div>").attr("title","Increase brush size (e)").addClass("fob brush inc").click(function(e){e.stopPropagation(),SFX.play("button"),tomni.prefs.increaseBrushSize()}).insertAfter($("#mst-slider-container")),function(){var e=$("#twoD"),t=$("<div>").addClass("twoD-borders").hide().insertAfter(e),n=t.get(0),a=e.get(0);new MutationObserver(function(e){e.forEach(function(e){if("attributes"===e.type&&"style"===e.attributeName){var t=a.getAttribute("style"),o=t.indexOf("transform"),i=n.getAttribute("style"),s=i.indexOf("transform");if(o>=0){var c=t.substring(o,t.indexOf(";",o)+1),r=i.substring(s,i.indexOf(";",s)+1);s>=0?n.setAttribute("style",i.replace(r,c)):n.setAttribute("style",i+c)}}})}).observe(e.get(0),{attributes:!0});var o=$("<div>").attr("title","Toggle spawn borders (b)").addClass("fob").text("SB").click(function(e){e.stopPropagation(),SFX.play("button"),t.toggle()}).appendTo($(".twoD-controls")),i=!0,s=tomni.play;tomni.play=function(e){1!==tomni.getCurrentCell().info.dataset_id?o.hide():o.show(),i?(setTimeout(function(){t.hide()},500),i=!1):t.hide(),s(e)},$(document).on("keydown.spawnBorders",function(e){tomni.gameMode&&1===tomni.getCurrentCell().info.dataset_id&&e.keyCode===Keycodes.codes.b&&(e.preventDefault(),SFX.play("button"),t.toggle())})}(),a.resolve()}),$(document).on("ewdlc-preferences-loading.extraControls",function(){ewdlc.preferences.registerSetting(e),ewdlc.preferences.registerSetting(n),e.registerCallback(i)}),$(document).on("ewdlc-preferences-loaded.extraControls",function(){o.resolve()}),$.when(a,o).then(function(){account.can("scout scythe mystic admin")&&ewdlc.settingsUi.makeCheckbox(e,"Enlarge in-cube buttons"),account.can("scythe mystic admin")||(n.registerCallback(s),ewdlc.settingsUi.makeCheckbox(n,"Swap move on/flag buttons"),s(0,n.getValue()))})}function p(){var e=$("#cubeInspectorFloatingControls"),n=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"style"===e.attributeName&&r()})}),a=new t("uibox-top",null,null),o=new t("uibox-left",null,null),i=new t("uibox-cube-tab",!1,!1);function s(e,t,n){return Math.max(t,Math.min(e,n))}function c(t,i){(function(t,a){n.disconnect(),e.css("top",t+"px"),e.css("left",a+"px"),n.observe(document.getElementById("cubeInspectorFloatingControls"),{attributes:!0})})(t=s(t,0,$(document).height()-e.outerHeight()),i=s(i,0,$(document).width()-e.outerWidth())),a.setValue(t),o.setValue(i)}function r(){var t=e.css("top"),n=e.css("left");"auto"===t||"auto"===n||n.includes("%")||c(d(t),d(n))}function l(e){e.addClass("tc");var t=new MutationObserver(function(n){n.forEach(function(n){if(0!=n.addedNodes.length){var a=$(n.target);e.children(".link").length>0||function(e,t){var n=e.text();if("-"!==n){e.empty();for(var a=n.split(", "),o=0;o<a.length;o++){var i=$("<span>").addClass("link"),s=parseInt(a[o],10);i.text(a[o]),i.data("target",s),i.click(function(e){$(this).addClass("clicked"),tomni.jumpToTaskID($(this).data("target")),e.stopPropagation()}),e.append(i),o<a.length-1&&e.append(", ")}t.takeRecords()}}(a,t)}})});t.observe(e[0],{childList:!0,characterData:!0})}function d(e){return parseInt(e.replace("px","").trim(),10)}$(document).on("ewdlc-preferences-loading",function(){ewdlc.preferences.registerSetting(a),ewdlc.preferences.registerSetting(o),ewdlc.preferences.registerSetting(i)}),$(document).on("ewdlc-preferences-loaded",function(){null!=a.getValue()&&null!=o.getValue()&&c(a.getValue(),o.getValue());var t=e.find(".info > .cube.minimalButton");i.getValue()?t.click():e.find(".info > .player.minimalButton").click(),new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"class"===e.attributeName&&i.setValue(t.hasClass("selected"))})}).observe(t.get(0),{attributes:!0}),n.observe(document.getElementById("cubeInspectorFloatingControls"),{attributes:!0}),$(document).resize(function(){r()})});var u=setInterval(function(){0!=e.length?(e.find("div.panel.player.selected").bind("DOMNodeInserted","li",function(){let e,t=$(this).children().last(),n=t.text();t.hasClass("admin")?e=Cell.ScytheVisionColors.reap:t.hasClass("scythe")?e=Cell.ScytheVisionColors.scythed:t.hasClass("complete")?e=Cell.ScytheVisionColors.complete2:t.hasClass("scout")&&(e=Cell.ScytheVisionColors.review),e&&t.css("color",e),"No Cube Selected"!==n&&t.on("click.floatinsp",function(){Profile.show({username:n})})}),l(e.find(".panel.cube > .parent_task > .value")),l(e.find(".panel.cube > .child_tasks > .value")),clearInterval(u)):e=$("#cubeInspectorFloatingControls")},500)}function g(){function e(e,t){$(e).each(function(){this.style.setProperty("color",t,"important")})}var t=setInterval(function(){document.getElementById("slPanel")&&(document.getElementById("slPanel").addEventListener("keypress",function(e){e.stopPropagation()}),console.log("Fixed Scouts' Log Review button bug."),clearInterval(t),e(".sl-need-admin",Cell.ScytheVisionColors.reap),e(".sl-need-scythe",Cell.ScytheVisionColors.scythed))},1e3)}function b(e){var t,n,a,o,i,s,c=this,r=!1,l=!1,d=!1,u={},h={},f={},m=[{key:"complete1",lang:"1 SC Vote"},{key:"complete2",lang:"2 SC Votes"},{key:"complete3",lang:"Admin SC"},{key:"review",lang:"Review"},{key:"scythed",lang:"Scythed"},{key:"reap",lang:"Reaped"},{key:"frozen",lang:"Frozen"},{key:"scythefrozen",lang:"Scythe Frozen"},{key:"duplicate",lang:"Duplicate"},{key:"base",lang:"Base"}];function p(e,t){return $("<div>").addClass("minimalButton").attr("id","prvw-action").text(t).appendTo(e)}function g(e){let n=$("<div>").attr("id","prvw-colors").appendTo(e),c=$("<div>").attr("id","prvw-actions").appendTo(e);!function(e){for(var n=0;n<m.length;n++){let a=$("<div>").attr("id","prvw-color").text(m[n].lang),o=m[n].key,i=$("<input>").attr("type","text").appendTo(a);i.spectrum({showInitial:!0,showInput:!0,preferredFormat:"hex",replacerClassName:"prvw-spectrum",move:function(e){f[o]=e.toHexString(),t.trigger("prvw-colors-changed")}}),a.appendTo(e),u[m[n].key]=i}}(n),a=p(c,"Save"),o=p(c,"Discard"),i=p(c,"Default"),s=p(c,"Exit Preview"),$("<div>").css("padding-left","10px").css("padding-bottom","5px").text("Note: Saved changes will take effect only after refreshing.").appendTo(e)}function b(){t=$("<div>").attr("id","prvw-container");let e=$("<div>").attr("id","prvw-top").appendTo(t),a=$("<div>").appendTo(t);g(e),function(e){n=$("<div>").attr("id","prvw-collapse").text("Preview Mode!").appendTo(e)}(a),t.appendTo($(".gameBoard"))}c.init=function(){r||(b(),n.click(function(e){if(e.stopPropagation(),d)return;let a={duration:600,queue:!1};if(l)t.animate({top:0},a),l=!1;else{let e=t.outerHeight()-n.outerHeight()+1;t.animate({top:-e},a),l=!0}}),t.on("keyup keydown keypress",function(e){e.stopPropagation()}),$(".sp-container").on("keyup keydown keypress",function(e){e.stopPropagation()}),o.on("click",function(e){e.stopPropagation(),c.setColors(h)}),a.on("click",function(e){e.stopPropagation(),h=$.extend({},f),t.trigger("prvw-colors-saved")}),i.on("click",function(t){t.stopPropagation();let n=$.extend({},h);c.setColors(e),h=n}),s.on("click",function(e){if(e.stopPropagation(),d)return;let n={duration:600,queue:!1,complete:function(){d&&t.hide()}};d=!0,t.animate({top:-t.outerHeight()},n),t.trigger("prvw-exited")}),t.css("top",-t.outerHeight()+"px"),t.hide(),d=!0,r=!0)},c.getColors=function(){return $.extend({},Cell.ScytheVisionColors,f)},c.setColors=function(e){if(r){e=e||{};for(let t in e)u[t]&&(u[t].spectrum("set",e[t]),h[t]=e[t],f[t]=e[t]);t.trigger("prvw-colors-changed")}},c.getContainer=function(){return t},c.show=function(){if(!d)return;d=!1,l=!1;t.show(),t.animate({top:0},{duration:600,queue:!1})}}function w(){var e,n,a,o,i,s,c,r,l,d=null,u=new t("prvw-colors",$.extend({},Cell.ScytheVisionColors)),h=[],f=$.Deferred(),m=$.Deferred(),p=$.Deferred();function g(){a&&a.abort(),o&&o.abort(),e=[],n={},c=tomni.getCurrentCell(),r=c.resetTaskColors,l=c.updateCompleteColoring,c.resetTaskColors=function(){},c.updateCompleteColoring=function(){},h=c.info.tags.ReapGrow?["scythed","complete1","complete2","complete3","review","reap","duplicate","frozen","scythefrozen"]:["complete1","complete2","complete3","review","scythed","reap","duplicate","frozen","scythefrozen"],s=!0,d.show(),i=!1,a=$.getJSON("/1.0/cell/"+tomni.cell+"/tasks").done(C),o=$.getJSON("/1.0/cell/"+tomni.cell+"/heatmap/scythe").done(k),$.when(a,o).done(function(){i=!0,y()})}function w(){s=!1,a&&a.abort(),o&&o.abort(),a=null,o=null,c&&(c.updateCompleteColoring=l,c.resetTaskColors=r,c.resetTaskColors({hard:!0})),r=null,c=null,e=null,n=null,h=null,i=!1}function v(){u.setValue($.extend({},u.getValue(),d.getColors()))}function y(){if(s&&i){var t=d.getColors();c.colorCubes({cubeids:e,color:ColorUtils.hexToRGB(t.base),blending:1});for(var a=0;a<h.length;a++)c.colorCubes({cubeids:n[h[a]],color:ColorUtils.hexToRGB(t[h[a]]),blending:1});c.render()}}function C(t){e=t.tasks.map(e=>e.id)}function k(e){n.scythed=e.scythed,n.reap=e.reaped,n.complete1=e.complete.filter(e=>1==e.votes).map(e=>e.id),n.complete2=e.complete.filter(e=>2==e.votes).map(e=>e.id),n.complete3=e.complete.filter(e=>e.votes>=1e6).map(e=>e.id),n.review=e.review,n.frozen=e.frozen,n.scythefrozen=e.scythe_frozen,n.duplicate=e.duplicate}jQuery.cachedScript=function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(t)},$("<link>").attr("rel","stylesheet").attr("href","https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css").appendTo($("head")),$.cachedScript("https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js").done(p.resolve),this.getView=function(){return d},$(document).on("ewdlc-account-ready",f.resolve),$(document).on("ewdlc-preferences-loaded.cellColorPicker",m.resolve),$.when(f,m,p).then(function(){if(!account.can("scout scythe mystic admin"))return;(d=new b($.extend({},Cell.ScytheVisionColors))).init(),d.setColors($.extend({},u.getValue()));let e=d.getContainer();e.on("prvw-exited.cellColorPicker",w),e.on("prvw-colors-changed.cellColorPicker",y),e.on("prvw-colors-saved.cellColorPicker",v),ewdlc.settingsUi.makeButton("Show Cell Color Picker").click(g)}),$(document).on("ewdlc-preferences-loading.cellColorPicker",function(){ewdlc.preferences.registerSetting(u)}),$(document).on("ewdlc-preferences-loaded.cellColorPicker",function(){$.extend(Cell.ScytheVisionColors,u.getValue())})}function v(){var e,t=$("#profileJoinedDate span"),n=$("#profileContainer #profUsername");(e=new MutationObserver(function(a){a.forEach(function(a){var o;0!==a.addedNodes.length&&(t.children("span").length>0||(o=n.text(),$.getJSON("/1.0/player/"+o+"/bio").done(function(n){var a=moment(1e3*n.joined),o=moment(),i=a.fromNow(),s=$("<span>").text(" ("+i+")"),c=o.diff(a,"years");o.add(-c,"years");var r=o.diff(a,"months");o.add(-r,"months");var l=o.diff(a,"days"),d=[];c>0&&d.push(c+"y"),r>0&&d.push(r+"m"),l>0&&d.push(l+"d"),d.length>0&&s.attr("title",d.join(", ")+" ago"),t.append(s.hide().fadeIn()),e.takeRecords()})))})})).observe(t[0],{childList:!0,characterData:!0})}var y={TabbedChat:Object.freeze({TabbedChatInit:function(){$("<link>").attr("rel","stylesheet").attr("type","text/css").attr("href",ewdlc.getResourceUrl("/css/ewdlc.min.css?v=2")).appendTo("head");var e=setInterval(function(){for(var t=!1,n=0;n<document.styleSheets.length;n++)document.styleSheets[n].href&&document.styleSheets[n].href.includes("/css/ewdlc.min.css?v=2")&&(t=!0);t&&($(".chatInput").trigger("keyup"),clearInterval(e))},500);$("<script>",{src:"https://use.fontawesome.com/7745d29f5b.js"}).appendTo("body"),u=new WebSocket("wss://eyewire.org/chat"),ewdlc.modules.tabbedChat=ewdlc.modules.tabbedChat||new d},TabbedChat:d,Tab:c,TabbedPrefs:r}),SkippableLeaderboard:Object.freeze({SkippableLeaderboard:h,SkippableLeaderboardInit:function(){ewdlc.modules.skippableLeaderboard=ewdlc.modules.skippableLeaderboard||new h}}),ExtraStats:Object.freeze({ExtraStats:f,ExtraStatsInit:function(){ewdlc.modules.extraStats=ewdlc.modules.extraStats||new f}}),ExtraControls:Object.freeze({ExtraControls:m,ExtraControlsInit:function(){ewdlc.modules.extraControls=ewdlc.modules.extraControls||new m}}),UiBoxImprovements:Object.freeze({UiBoxImprovements:p,UiBoxImprovementsInit:function(){ewdlc.modules.uiBoxImprovements=ewdlc.modules.uiBoxImprovements||new p}}),SlHacks:Object.freeze({SlHacks:g,SlHacksInit:function(){ewdlc.modules.slHacks=ewdlc.modules.slHacks||new g}}),CellColorPicker:Object.freeze({CellColorPickerInit:function(){ewdlc.modules.cellColorPicker=ewdlc.modules.cellColorPicker||new w},CellColorPicker:w}),ProfileWindowChanges:Object.freeze({ProfileWindowChangesInit:function(){ewdlc.modules.profileWindowChanges=ewdlc.modules.profileWindowChanges||new v,$("body").append('<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js" integrity="sha256-ABVkpwb9K9PxubvRrHMkk6wmWcIHUE9eBxNZLXYQ84k=" crossorigin="anonymous"><\/script>')},ProfileWindowChanges:v})};return $(document).ready(function(){0!=$(".gameBoard").length&&(window.ewdlc=new s("https://chrisraven.github.io/EWDLC/build/static"),function(){for(var e in y)y[e][e+"Init"]()}(),ewdlc.init())}),e.Modules=y,e.EWDLC=s,e.Preferences=n,e.Account=a,e.Setting=t,e.SettingsUi=o,e.TaskStatus=i,e}({});
//# sourceMappingURL=ewdlc.min.js.map